# Splatoon 3 AI コーチングサービス - コスト最適化分析

## 想定利用規模
- 月間アクティブユーザー: 1,000人
- 1ユーザーあたり月間バトル数: 300試合
- 1ユーザーあたり月間AI分析回数: 10回

## 現在の構成での月額コスト試算

### 1. AWS サービス
- **RDS PostgreSQL (t4g.micro)**: ~$15/月
- **ElastiCache Redis (t4g.micro)**: ~$13/月
- **Lambda**: ~$5/月 (100万リクエスト想定)
- **DynamoDB**: ~$2/月 (トークン保存)
- **KMS**: ~$1/月
- **S3**: ~$1/月
- **CloudWatch**: ~$3/月
- **小計**: ~$40/月

### 2. Azure OpenAI (GPT-4o)
- 入力: $2.50/1Mトークン
- 出力: $10.00/1Mトークン
- 月間使用量: 10,000回 × 2,000トークン = 20Mトークン
- **月額**: ~$150/月

### 3. インフラ
- **Vercel (Next.js)**: $20/月 (Proプラン)
- **ドメイン**: ~$1/月

### 合計: ~$211/月

## コスト削減案

### 1. データベース最適化
**現在**: RDS PostgreSQL ($15/月)
**代替案**:
- Supabase Free Tier: $0/月 (500MB、5GB帯域幅)
- PlanetScale Free Tier: $0/月 (5GB、10億行読み取り)
- Neon Free Tier: $0/月 (3GB)
**節約**: $15/月

### 2. Redis代替
**現在**: ElastiCache Redis ($13/月)
**代替案**:
- Upstash Redis Free Tier: $0/月 (10,000コマンド/日)
- インメモリキャッシュ (Next.js内): $0/月
**節約**: $13/月

### 3. 認証トークン保存
**現在**: DynamoDB + KMS ($3/月)
**代替案**:
- Supabase Auth: $0/月 (認証機能込み)
- 暗号化はアプリケーションレベルで実装
**節約**: $3/月

### 4. AI分析の最適化
**現在**: GPT-4o ($150/月)
**代替案**:
```
1. モデルの使い分け:
   - 簡単な分析: GPT-3.5-turbo ($0.50/1M入力、$1.50/1M出力)
   - 詳細分析のみ: GPT-4o
   - 節約: ~$100/月

2. プロンプト最適化:
   - トークン数削減 (1,000トークン/回に圧縮)
   - 節約: ~$75/月

3. キャッシング戦略:
   - 類似試合パターンの分析結果を再利用
   - 節約: ~$30/月
```
**節約**: ~$100/月

### 5. ホスティング最適化
**現在**: Vercel Pro ($20/月)
**代替案**:
- Vercel Hobby: $0/月 (商用利用不可)
- Netlify Free: $0/月 (100GB帯域幅)
- Railway: $5/月 (開始プラン)
**節約**: $15/月

### 6. Lambda最適化
**現在**: AWS Lambda ($5/月)
**代替案**:
- Vercel Functions (Hobbyプラン込み): $0/月
- Netlify Functions: $0/月 (125,000リクエスト/月)
**節約**: $5/月

## 最適化後の構成（実装済み）

### 推奨構成A: 完全無料版 (プロトタイプ向け) ✅ **採用**
- **Database**: Supabase Free
- **Cache**: 初期はインメモリ（後でUpstash追加予定）
- **Auth/Token**: Supabase Auth（実装済み）
- **AI**: GPT-3.5-turbo + 積極的キャッシング
- **Hosting**: Vercel Hobby ($0/月)
- **Functions**: Supabase Edge Functions
- **月額**: ~$25 (AI費用のみ)

### 推奨構成B: バランス版 (本番向け)
- **Database**: Supabase Pro ($25/月)
- **Cache**: Upstash Redis Pro ($10/月)
- **Auth**: Supabase Auth
- **AI**: GPT-3.5/4o混合 + キャッシング
- **Hosting**: Vercel Pro ($20/月)
- **Functions**: Supabase Edge Functions
- **月額**: ~$55 → ~$100 (成長時)

### 推奨構成C: エンタープライズ版
- **Database**: AWS RDS (予約インスタンス)
- **Cache**: ElastiCache (予約)
- **Auth**: AWS Cognito
- **AI**: Azure OpenAI (コミット価格)
- **Hosting**: AWS ECS/Fargate
- **月額**: ~$150 (年間契約で20%割引)

## 段階的移行戦略

### Phase 1: MVP (月額 $25) ✅ **進行中**
1. Supabase (DB + Auth) - **実装済み**
2. GPT-3.5-turbo - **予定**
3. Vercel Hobby無料プラン - **実装済み**
4. 基本機能のみ - **進行中**

### Phase 2: β版 (月額 $55)
1. Vercel Pro移行
2. Upstash Redis追加
3. GPT-4o混合利用
4. 分析機能拡充

### Phase 3: 本番 (月額 $100+)
1. Supabase Pro有料プラン
2. 専用Redis
3. カスタムドメイン
4. 監視ツール追加

## その他のコスト削減施策

### 1. 技術的最適化
- **バッチ処理**: Nintendo API呼び出しをまとめる
- **差分更新**: 新規試合のみ取得
- **圧縮**: データ転送量削減
- **CDN活用**: 静的アセットキャッシュ

### 2. ビジネスモデル
- **フリーミアム**: 基本無料、詳細分析は有料
- **分析回数制限**: 無料は月5回まで
- **広告収入**: 適切な広告配置
- **プレミアムプラン**: $5/月で無制限分析

### 3. オープンソース活用
- **Plausible Analytics**: Google Analytics代替
- **Sentry Community**: エラー監視
- **n8n**: ワークフロー自動化

## 結論

初期段階では**推奨構成A**（月額$25）でスタートし、ユーザー数に応じて段階的にスケールアップすることを推奨します。

主な節約ポイント:
1. マネージドサービスの無料枠を最大活用
2. AI使用量の最適化とキャッシング
3. 必要に応じた段階的なスケーリング

これにより、初期コストを90%削減（$211→$25）できます。